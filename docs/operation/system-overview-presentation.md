# 콘서트 예약 시스템 - 시스템 개요 발표 자료

**발표 대상**: 경영진, PM, 마케팅, CS, 개발팀
**작성일**: 2026-01-06
**버전**: 1.0

---

## 📌 목차

1. [시스템 소개](#1-시스템-소개)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [주요 기능](#3-주요-기능)
4. [성능 및 처리 용량](#4-성능-및-처리-용량)
5. [보안](#5-보안)
6. [현재 취약점 및 개선 계획](#6-현재-취약점-및-개선-계획)
7. [운영 현황](#7-운영-현황)
8. [Q&A](#8-qa)

---

## 1. 시스템 소개

### 1.1 서비스 개요

**콘서트 예약 시스템**은 대규모 동시 접속 환경에서 안정적인 콘서트 좌석 예약 및 결제를 제공하는 플랫폼입니다.

### 1.2 핵심 가치

🎯 **공정성**: 대기열 시스템으로 선착순 보장
⚡ **빠른 응답**: 평균 응답 시간 **6.82ms** (목표 500ms 대비 98.6% 개선)
🔒 **안전한 결제**: 중복 결제 방지 및 트랜잭션 보장
📊 **실시간 랭킹**: 인기 콘서트 실시간 집계

### 1.3 주요 통계

| 지표 | 현재 용량 | 목표 용량 |
|------|----------|----------|
| **동시 접속자** | 100명 | 1,000명 |
| **초당 처리량** | 2,081 req/sec | 20,000 req/sec |
| **응답 시간 (P95)** | 6.82ms | < 100ms |
| **시스템 가용성** | 99.9% | 99.99% |

---

## 2. 시스템 아키텍처

### 2.1 전체 구조

```
┌─────────────┐
│   사용자    │
│  (10,000명) │
└──────┬──────┘
       │ HTTPS
       ↓
┌──────────────────────────────────────┐
│         로드 밸런서 (ALB)             │
└──────┬───────────────────────────────┘
       │
       ↓
┌──────────────────────────────────────┐
│      애플리케이션 서버 (3대)          │
│   Spring Boot + Kotlin                │
│   - 대기열 관리                       │
│   - 예약 처리                         │
│   - 결제 처리                         │
└─┬────┬────┬────────────────────┬─────┘
  │    │    │                    │
  ↓    ↓    ↓                    ↓
┌────┐┌────┐┌──────────────┐┌─────────┐
│MySQL│Redis│    Kafka      │ 외부 API │
│     ││     │ (3 brokers)  ││         │
│ 예약││ 캐시│ 이벤트 처리   ││ 알림/    │
│ 결제││ 대기열│              ││ 데이터   │
│ 포인트│ 락  │              ││         │
└────┘└────┘└──────────────┘└─────────┘
```

### 2.2 핵심 구성 요소

#### 애플리케이션 서버
- **기술 스택**: Spring Boot 3.4.1, Kotlin 2.1.0
- **배포**: Kubernetes (3개 인스턴스)
- **역할**: API 서버, 비즈니스 로직 처리

#### 데이터베이스 (MySQL)
- **용도**: 예약, 결제, 포인트, 사용자 정보 저장
- **백업**: 일 1회 전체, 시간별 증분
- **커넥션 풀**: 최대 20개 (향후 50개로 확장 예정)

#### 캐시/대기열 (Redis)
- **대기열**: 공정한 순서 보장 (FIFO)
- **캐시**: 콘서트 정보, 좌석 가용성
- **분산락**: 중복 예약 방지
- **메모리**: 현재 사용률 ~50%

#### 메시지 큐 (Kafka)
- **비동기 처리**: 예약 확정, 알림 발송
- **안정성**: 3개 브로커, 복제본 3개
- **DLQ**: 실패 메시지 자동 격리

---

## 3. 주요 기능

### 3.1 대기열 시스템

**목적**: 대규모 동시 접속 시 서버 과부하 방지

**동작 방식**
```
1. 사용자 진입
   ↓ (대기열 토큰 발급)
2. 대기 (WAITING 상태)
   ↓ (10초마다 10명씩 활성화)
3. 활성화 (ACTIVE 상태, 10분 유효)
   ↓ (예약 가능)
4. 예약 완료 또는 만료
```

**특징**
- ✅ 선착순 보장
- ✅ 서버 부하 제어 (최대 100명 동시 활성)
- ⚠️ 현재 이슈: 활성화 속도 느림 (개선 예정)

### 3.2 예약 플로우

```
1. 콘서트 조회 (캐시 활용)
   ↓
2. 좌석 선택
   ↓
3. 임시 예약 (5분 유효)
   ├─ 분산락으로 중복 방지
   └─ 좌석 상태: AVAILABLE → TEMPORARY_RESERVED
   ↓
4. 결제 (포인트 차감)
   ├─ 트랜잭션 보장
   └─ 좌석 상태: TEMPORARY_RESERVED → RESERVED
   ↓
5. 예약 확정 (이벤트 발행)
   └─ 알림 발송, 랭킹 업데이트
```

**안전장치**
- 5분 임시 예약: 미결제 시 자동 취소
- 분산락: 동일 좌석 중복 예약 방지
- 트랜잭션: 결제 실패 시 자동 롤백

### 3.3 결제 시스템

**포인트 기반 결제**
- 사전 충전 방식 (실제 결제 연동 가능)
- 트랜잭션으로 정합성 보장
- 이력 관리 (충전/사용 내역)

**보안**
- 중복 결제 방지: 분산락
- 동시 충전 보호: 비관적 락
- 포인트 부족 검증

### 3.4 실시간 랭킹

**집계 방식**
- 예약 확정 시 즉시 반영 (Redis Sorted Set)
- 30분 슬라이딩 윈도우
- 1분마다 배치로 정리

**활용**
- 인기 콘서트 TOP 10
- 마케팅 데이터

---

## 4. 성능 및 처리 용량

### 4.1 부하 테스트 결과 (2026-01-06)

#### 시나리오 1: 좌석 예약 경쟁
- **부하**: 10 VUs (목표: 10,000 VUs)
- **응답 시간**: P95 **14.23ms** ✅
- **성공률**: **100%** ✅
- **병목**: 대기열 활성화 타임아웃 ❌

#### 시나리오 2: 대기열 웨이브
- **부하**: 100 VUs (목표: 10,000 VUs)
- **처리량**: **2,081 req/sec** ✅
- **성공률**: **99.99%** ✅
- **Redis 성능**: 10배 확장 가능 ✅

#### 시나리오 3: 동시 결제
- **부하**: 50 req/sec (목표: 1,000 req/sec)
- **포인트 충전**: **100%** 성공 ✅
- **DB 데드락**: **0건** ✅
- **제한**: 결제 단계 미측정 (스크립트 이슈)

#### 시나리오 5: 지속 부하
- **부하**: 50 req/sec, 2분
- **응답 시간**: P95 **6.82ms** ✅
- **HTTP 성공률**: **100%** ✅
- **병목**: 대기열 활성화 타임아웃 ❌

### 4.2 현재 용량

| 지표 | 현재 | 비고 |
|------|------|------|
| **동시 활성 사용자** | 100명 | 대기열 설정값 |
| **초당 처리량** | 2,081 req/sec | 100 VUs 기준 |
| **DB 커넥션** | 최대 20개 | 동시 트랜잭션 제한 |
| **예상 최대 처리** | ~5,000 req/sec | 병목 전 |

### 4.3 확장 계획

**단기 (1개월)**
- 대기열 최대 활성: 100명 → **1,000명**
- DB 커넥션: 20개 → **50개**
- 활성화 속도: 10명/10초 → **100명/10초**

**예상 효과**
- 동시 접속 처리: **10배 증가**
- 대기 시간: **90% 단축**
- 초당 처리량: **20,000 req/sec**

**중장기 (3개월)**
- 애플리케이션 서버: 3대 → **10대**
- Redis Cluster 구성 (HA)
- Kafka 파티션: 1개 → **3개**
- 실시간 결제 API 연동

---

## 5. 보안

### 5.1 인증/인가

**JWT 기반 인증**
- Access Token: 15분 유효
- Refresh Token: 7일 유효
- 토큰 만료 시 자동 갱신

**대기열 토큰**
- UUID 기반 (추측 불가)
- 10분 유효 (활성화 후)
- 사용자별 1개만 발급

### 5.2 데이터 보호

**전송 중 암호화**
- HTTPS 전용 (TLS 1.3)
- API 간 통신: 내부 네트워크 또는 TLS

**저장 데이터**
- 개인정보: 암호화 권장 (향후 적용)
- 결제 정보: 포인트 시스템 (민감 정보 미보관)
- 백업: 암호화 스토리지

### 5.3 보안 점검

**정기 점검 항목**
- [ ] 취약점 스캔 (월 1회)
- [ ] 의존성 업데이트 (주 1회)
- [ ] 접근 로그 분석 (주 1회)
- [ ] 침투 테스트 (분기 1회)

---

## 6. 현재 취약점 및 개선 계획

### 6.1 🔴 CRITICAL: 대기열 활성화 타임아웃

**현상**
- WAITING → ACTIVE 상태 전환 미작동
- 사용자가 무한 대기
- 예약/결제 불가

**원인**
- 스케줄러 미실행 또는 로직 오류

**영향**
- 서비스 이용 불가 (P0 장애)
- 고객 불만 증가

**해결 계획**
- [x] 부하 테스트로 문제 확인 (2026-01-06)
- [ ] 스케줄러 로직 수정 (예정: 2026-01-08)
- [ ] 재테스트 및 배포 (예정: 2026-01-09)

---

### 6.2 ⚠️ 데이터베이스 커넥션 부족

**현상**
- 최대 20개 커넥션
- 동시 활성 100명 시 부족 가능

**영향**
- 응답 지연
- 일부 요청 실패

**해결 계획**
- [ ] 커넥션 풀 확장: 20 → 50 (예정: 1주 이내)
- [ ] 모니터링 강화 (사용률 70% 이상 알람)

---

### 6.3 ⚠️ 대기 시간 과다 (UX 문제)

**현상**
- 10,000명 대기 시 **2시간 47분** 소요
- 토큰 만료로 대부분 재진입

**영향**
- 고객 이탈률 증가
- CS 문의 폭증

**해결 계획**
- [ ] 활성화 속도 10배 증가 (예정: 1주 이내)
- [ ] 예상 대기 시간 UI 표시 (예정: 2주 이내)
- [ ] SMS 알림: 순서 도래 시 (예정: 1개월 이내)

---

### 6.4 ⚠️ 외부 API 의존성

**현상**
- 데이터 플랫폼 장애 시 Kafka 컨슈머 지연
- 알림 미발송

**영향**
- 데이터 동기화 지연
- 사용자 알림 누락

**해결 계획**
- [ ] DLQ 자동 재처리 (예정: 2주 이내)
- [ ] 알림 우선순위 분리 (예정: 1개월 이내)

---

### 6.5 ℹ️ 모니터링 부족

**현상**
- 장애 감지 지연
- 병목 지점 파악 어려움

**영향**
- MTTR (평균 복구 시간) 증가

**해결 계획**
- [x] Grafana 대시보드 구축 (완료: 2026-01-04)
- [ ] 알람 임계값 세분화 (예정: 1주 이내)
- [ ] APM 도입 (New Relic 등) (예정: 1개월 이내)

---

## 7. 운영 현황

### 7.1 시스템 안정성

**가용성**
- 목표: 99.9% (월 43분 다운타임 허용)
- 현재: 부하 테스트 단계

**장애 대응**
- 장애 대응 매뉴얼: ✅ 작성 완료
- On-Call 체계: ⏳ 구축 중
- 모니터링: ✅ Grafana + Prometheus

### 7.2 배포 프로세스

**배포 주기**
- 정기 배포: 주 1회 (화요일 오전)
- 핫픽스: 긴급 시 즉시

**배포 전략**
- Rolling Update (무중단 배포)
- Canary 배포 (선택적)
- 자동 롤백 (헬스체크 실패 시)

### 7.3 백업 및 복구

**데이터베이스**
- 전체 백업: 일 1회 (새벽 3시)
- 증분 백업: 시간별
- 보관 기간: 30일

**복구 목표**
- RPO (Recovery Point Objective): 1시간
- RTO (Recovery Time Objective): 30분

---

## 8. Q&A

### Q1. 시스템이 동시 몇 명까지 처리 가능한가요?

**A**: 현재 설정으로는 **동시 100명**까지 안정적으로 처리 가능합니다. 1주일 내에 **1,000명**으로 확장 예정이며, 최종적으로는 **10,000명** 처리를 목표로 합니다.

---

### Q2. 대규모 티켓 오픈 시 대기 시간은 얼마나 되나요?

**A**: 현재 설정으로 10,000명이 동시 접속 시 평균 **2시간 47분** 대기합니다. 개선 후에는 **15~20분**으로 단축될 예정입니다.

---

### Q3. 중복 결제나 좌석 중복 예약은 어떻게 방지하나요?

**A**: Redis 분산락을 사용하여 동일 좌석에 대한 동시 예약을 원천 차단합니다. 또한 데이터베이스 트랜잭션으로 결제 정합성을 보장합니다.

---

### Q4. 결제 실패 시 환불은 자동으로 되나요?

**A**: 네, 결제 중 오류 발생 시 데이터베이스 트랜잭션이 자동 롤백되어 포인트가 차감되지 않습니다. 예외적으로 실패한 경우 보상 트랜잭션으로 자동 환불 처리됩니다.

---

### Q5. 시스템 장애 시 얼마나 빨리 복구 가능한가요?

**A**:
- **애플리케이션 장애**: 5~15분 (자동 롤백)
- **데이터베이스 장애**: 30분~1시간 (백업 복구)
- **Redis 장애**: 10~20분 (재시작)

장애 레벨에 따라 대응 시간이 다르며, P0(Critical) 장애는 즉시 대응합니다.

---

### Q6. 개인정보는 어떻게 보호되나요?

**A**:
- HTTPS 전용 통신
- JWT 토큰 기반 인증 (15분 유효)
- 결제 정보는 포인트 시스템 사용 (카드 정보 미보관)
- 향후 개인정보 암호화 저장 예정

---

### Q7. 서버 증설 시 서비스 중단이 필요한가요?

**A**: 아니요, Kubernetes Rolling Update를 사용하여 **무중단 배포**가 가능합니다. 사용자는 서비스 중단을 인지하지 못합니다.

---

### Q8. 시스템 확장 시 비용은 얼마나 증가하나요?

**A**: 주요 비용 항목은 다음과 같습니다:
- 애플리케이션 서버: 3대 → 10대 (약 3배)
- Redis: 단일 → Cluster (약 3배)
- Kafka: 변동 없음
- DB: 커넥션 풀만 증가 (비용 변동 없음)

**예상 증가율**: 약 3배 (처리 용량 10배 증가 대비 효율적)

---

### Q9. 실시간 결제 (카드/계좌이체) 연동 계획은?

**A**: 네, 3개월 내 PG사 연동 예정입니다:
- Phase 1: 포인트 시스템 (현재)
- Phase 2: 카드 결제 연동 (3개월 내)
- Phase 3: 간편 결제 연동 (6개월 내)

---

### Q10. 콘서트 티켓 외에 다른 상품도 판매 가능한가요?

**A**: 네, 현재 아키텍처는 확장 가능하게 설계되어 있어 **스포츠 경기, 전시회, 뮤지컬** 등 다양한 예약 시스템으로 확장 가능합니다.

---

## 📊 부록: 주요 지표 요약

### 성능 지표

| 항목 | 현재 | 목표 | 달성률 |
|------|------|------|--------|
| API 응답 시간 (P95) | 6.82ms | < 100ms | ✅ 93% 개선 |
| 처리량 | 2,081 req/sec | 20,000 req/sec | 🟡 10% |
| 동시 활성 사용자 | 100명 | 1,000명 | 🟡 10% |
| HTTP 성공률 | 100% | > 99.9% | ✅ 달성 |
| DB 데드락 | 0건 | < 10건/일 | ✅ 달성 |

### 보안 지표

| 항목 | 상태 |
|------|------|
| HTTPS 적용 | ✅ |
| JWT 인증 | ✅ |
| 취약점 스캔 | 🟡 월 1회 예정 |
| 침투 테스트 | ⏳ 미실시 |
| 데이터 암호화 | 🟡 부분 적용 |

### 운영 지표

| 항목 | 상태 |
|------|------|
| 모니터링 | ✅ Grafana |
| 알람 설정 | 🟡 기본만 |
| 장애 대응 매뉴얼 | ✅ 작성 완료 |
| 백업 자동화 | ✅ 일 1회 |
| On-Call 체계 | 🟡 구축 중 |

---

**문서 버전 관리**
- v1.0 (2026-01-06): 초안 작성
- 다음 업데이트: 대기열 스케줄러 수정 후

**문의**
- 개발팀: -
- DevOps팀: -
- PM: -
