# 시나리오 2: 대기열 활성화 웨이브 테스트

**테스트 일시**: 2026-01-06
**테스트 조건**: 100 VUs, 1분 30초 (원래 목표: 10,000 VUs)

---

## 테스트 목적

10,000명이 동시에 대기열 진입 후 활성화 대기 (테스트용 100 VUs로 축소)
- Redis Sorted Set 성능 검증
- 대량 토큰 발급 처리량 측정

---

## 핵심 결과

### ✅ 우수한 성능

| 지표 | 결과 | 평가 |
|------|------|------|
| **토큰 발급 성공률** | **99.99%** (189,404/189,409건) | ✅ 거의 완벽 |
| **처리량** | **2,081 req/sec** | ✅ 매우 높음 |
| **P95 응답시간** | **32.39ms** | ✅ 목표(200ms) 대비 84% 개선 |
| **HTTP 실패율** | **0.00%** (5건만 실패) | ✅ 완벽 |
| **평균 응답시간** | **15.76ms** | ✅ 매우 빠름 |

### ❌ 차단 이슈

**대기열 활성화 타임아웃** (시나리오 1과 동일)
- WAITING → ACTIVE 상태 전환 미작동
- 스케줄러 미실행 또는 Redis 상태 변경 로직 문제

---

## 상세 메트릭

```
총 요청 수: 189,409건
처리량: 2,081 req/sec

응답 시간:
  - 평균: 15.76ms
  - P90: 27.13ms
  - P95: 32.39ms
  - Max: 165.72ms

데이터:
  - 수신: 114 MB (1.3 MB/s)
  - 전송: 31 MB (339 KB/s)
```

---

## 성능 평가

### ✅ 우수한 점
- **Redis 성능**: P95 32ms로 매우 빠름
- **처리량**: 2,081 req/sec (10배 확장 시 20,000 req/sec 예상)
- **안정성**: 99.99% 성공률, 시스템 크래시 없음

### 스케일링 예측

현재 100 VUs 기준으로 10,000 VUs 확장 시:
- 예상 처리량: **20,000 ~ 25,000 req/sec**
- Redis 부하: 현재의 100배 (모니터링 필요)
- DB 커넥션: HikariCP 최대 20 → 100으로 증가 권장

---

## 제한사항

**k6 스크립트 데이터 공유 문제**
- `queue_entry`와 `queue_polling` 시나리오 간 변수 공유 불가
- 토큰 발급 후 폴링 테스트 미측정
- 스크립트 리팩토링 필요 (단일 시나리오로 통합)

---

## 다음 단계

**이슈 해결 후**:
1. k6 스크립트 리팩토링 (시나리오 통합)
2. 대기열 스케줄러 수정
3. 시나리오 2 재실행 (10,000 VUs)

---

**보고서 작성**: 2026-01-06
**상태**: ✅ 성능 우수 / ❌ E2E 차단 (대기열 활성화)
